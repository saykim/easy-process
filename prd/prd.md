# Product Requirements Document(PRD)

## 0. 문서 개요

* **제품명**: Food Process Designer (가칭)
* **목표**: 식품 공정 프로세스를 **클래스 다이어그램(Class Diagram)**과 **플로우 다이어그램(Flow Diagram)**으로 빠르고 정확하게 작성, 저장, 버전관리, 재사용할 수 있는 웹 애플리케이션.
* **핵심 가치**: 도메인 특화 노드·엣지 팔레트, 스냅 연결, 템플릿, 버전 관리.
* **대상 사용자**: 제조본부 프로세스 엔지니어, 품질/설비 엔지니어, DX/IT 기획자, 외부 SI 파트너.

---

## 1. 목표와 비목표

### 1.1 목표(Goals)

1. 드래그&드롭으로 공정 노드 배치.
2. 다양한 엣지 스타일(실선/점선/굵은선) 연결과 자동 스냅.
3. 노드 속성 패널에서 공정명·특이사항·산출물·운전방법 입력.
4. 검사장비(X-ray, 금속검출기, 중량검사기) 전용 노드 제공.
5. 분기 노드(마름모, Yes/No) 제공.
6. 템플릿 저장/불러오기.
7. 생성·수정·삭제 전 과정의 버전 관리.
8. 플로우 다이어그램과 클래스 다이어그램 모두 지원.

### 1.2 비목표(Non-Goals)

* 시뮬레이션, 공정 용량 계획(APS), 실시간 설비 데이터 연동(OT)은 본 버전 범위 아님.
* MES/QMS/ERP 실연동은 차기 단계.

---

## 2. 사용자 시나리오(User Stories)

* **US-01**: 공정 엔지니어로서, 노드와 엣지를 끌어와 배치/연결해 공정 흐름도를 만든다.
* **US-02**: 품질 담당자로서, X-ray/금속검출기/중량검사기 노드를 표준 기호로 배치한다.
* **US-03**: 기획자로서, 분기(Yes/No)를 통해 공정 조건 분기를 표현한다.
* **US-04**: 프로젝트 리더로서, 팀의 표준 템플릿을 불러와 수정 후 새 버전으로 저장한다.
* **US-05**: 리뷰어로서, 특정 버전의 다이어그램을 열람하고 변경 이력을 확인한다.
* **US-06**: 설계자로서, 클래스 다이어그램으로 공정 엔티티와 속성/관계를 정의한다.

---

## 3. 기능 요건(Functional Requirements)

### 3.1 캔버스/팔레트/툴바

* **FR-01 팔레트**: 기본 노드(사각형/원/마름모/주석), 도메인 노드(공정, 검사장비), 커넥터(실선/점선/굵은선) 제공.
* **FR-02 캔버스**: 무한 캔버스, 줌(±), 팬, 그리드 온/오프, 격자 스냅.
* **FR-03 툴바**: 선택, 다중선택, 정렬/정돈(좌/우/상/하 정렬, 균등 간격), 되돌리기/다시하기, 그룹화/해제.

### 3.2 노드

* **FR-10 노드 배치**: 드래그&드롭으로 배치, 복제(⌘/Ctrl+D), 삭제(Del).
* **FR-11 앵커/스냅**: 노드 상/하/좌/우 앵커 제공. 엣지 연결 시 자석 스냅 효과.
* **FR-12 속성 패널**: 선택 노드의 속성 편집. 필드: 공정 이름(required), 특이사항, 산출물, 운전방법. 라벨 프리뷰.
* **FR-13 도메인 노드**: 검사장비 3종 전용 아이콘/스타일. 속성: 제조사, 모델, 점검 주기, 알람 기준(선택).
* **FR-14 마름모 노드**: 분기 조건 라벨링. 기본 출력 포트 2개(Yes/No), 라벨 편집 가능.

### 3.3 엣지

* **FR-20 엣지 생성**: 앵커 간 드래그로 연결. 직선/곡선 자동 라우팅.
* **FR-21 스타일**: 실선/점선/굵은선. 두께/점선 패턴 선택. 방향 화살표 on/off.
* **FR-22 레이블**: 엣지 라벨 입력 가능(예: 조건, 배치번호, 라인명).
* **FR-23 리라우팅**: 드래그로 경로 조정. 자동 충돌 회피.

### 3.4 다이어그램 타입

* **FR-30 플로우 다이어그램**: 공정 흐름표현 기본.
* **FR-31 클래스 다이어그램**: 클래스/속성/관계(연관/집합/상속) 표현. 클래스-공정 매핑 메모 가능.

### 3.5 템플릿/파일 관리

* **FR-40 템플릿 저장**: 현재 다이어그램을 템플릿으로 저장. 카테고리/태그 지정.
* **FR-41 템플릿 불러오기**: 템플릿 선택 후 캔버스에 삽입 또는 새 문서로 열기.
* **FR-42 가져오기/내보내기**: JSON(원본), SVG/PNG/PDF(시안), PlantUML(선택) 내보내기. JSON/PlantUML 가져오기.

### 3.6 버전 관리/협업

* **FR-50 버전 생성**: 생성/수정/삭제 시 버전 생성(자동 또는 수동 태그). 메시지 입력.
* **FR-51 버전 비교**: 노드/엣지 추가·변경·삭제 하이라이트. 변경 로그.
* **FR-52 되돌리기**: 이전 버전으로 롤백(읽기 전용 확인 후 확정).
* **FR-53 권한(RBAC)**: 소유자/편집자/뷰어. 링크 공유(뷰 전용).

### 3.7 검색/필터/검증

* **FR-60 검색**: 노드명, 속성, 태그 검색.
* **FR-61 검증**: 미연결 앵커, 고립 노드, 순환 경로 경고.
* **FR-62 스타일 가이드**: 회사 표준 테마 적용(선 두께/색상/폰트 등 프리셋).

### 3.8 접근성/국제화

* **FR-70 접근성**: 키보드 내비게이션, ARIA 라벨.
* **FR-71 국제화(i18n)**: 한/영 전환. 숫자/단위 현지화.

---

## 4. 비기능 요건(Non-Functional Requirements)

* **NFR-01 성능**: 1,000 노드/1,500 엣지 문서를 60FPS 인터랙션으로 편집 가능.
* **NFR-02 안정성**: 자동 저장(5초), 로컬 리커버리, 충돌 방지.
* **NFR-03 보안**: 인증(SSO/이메일), 권한(RBAC), 전송/저장 암호화.
* **NFR-04 가용성**: 99.5% 이상. 장애 알림 배너.
* **NFR-05 관측성**: 로그/메트릭/에러 추적(Sentry 유사), 사용자 행동 이벤트(동의 기반).

---

## 5. 정보 구조 및 데이터 모델

### 5.1 주요 엔티티

* **Project**: {id, name, description, tags[], ownerId, createdAt}
* **Diagram**: {id, projectId, type: 'flow'|'class', title, description}
* **Node**: {id, diagramId, type, position{x,y}, size{w,h}, props{ name, notes, outputs, operation, deviceMeta? }, anchors}
* **Edge**: {id, diagramId, sourceNodeId, sourceAnchor, targetNodeId, targetAnchor, style{'solid'|'dotted'|'bold'}, width, arrow, label}
* **Template**: {id, title, category, tags[], payload(JSON), version}
* **Version**: {id, diagramId, semver, message, diff, createdBy, createdAt}
* **User**: {id, name, email, role}
* **AuditLog**: {id, actorId, action, entityType, entityId, payload, at}

### 5.2 속성 스키마 예시(JSON)

```json
{
  "node": {
    "type": "process|device|decision|note",
    "props": {
      "name": "혼합",
      "notes": "점도 주의",
      "outputs": "배치 100kg",
      "operation": "RPM 120, 10min",
      "deviceMeta": {"category": "xray|metal|weight", "model": "XR-200"}
    }
  },
  "edge": {"style": "solid|dotted|bold", "label": "라인A", "arrow": true}
}
```

---

## 6. UX/UI 요구사항

* **레이아웃**: 좌측 팔레트, 중앙 캔버스, 우측 속성 패널, 상단 툴바, 하단 버전 바.
* **스냅 효과**: 앵커 근접 시 자기력 애니메이션과 가이드선.
* **장비 아이콘**: X-ray, 금속검출기, 중량검사기 전용 아이콘과 색상 테마.
* **분기 노드**: 마름모 기본 Yes/No 포트 라벨 노출. 엣지에도 라벨 동기화 옵션.
* **템플릿 갤러리**: 썸네일 카드, 태그 필터, 미리보기.
* **다이어그램 타입 토글**: Flow/Class 전환은 문서 단위. 동일 프로젝트 내 여러 다이어그램 관리.
* **키보드 단축키**: ⌘/Ctrl+Z/Y, ⌘/Ctrl+C/V, ⌘/Ctrl+D, Delete, Shift+드래그(다중선택), 1/2/3(엣지 스타일 토글).

---

## 7. 시스템 아키텍처(제안)

* **프론트엔드**: Next.js(App Router) + TypeScript, shadcn/ui + Tailwind CSS, React Flow(다이어그램 엔진), Zustand(상태) 또는 Redux Toolkit.
* **백엔드**: Next.js Route Handlers(API) + Prisma(ORM) + PostgreSQL. 파일 내보내기 렌더러(서버 측 SVG/PDF).
* **인증**: 이메일/SSO(OpenID Connect) 지원.
* **스토리지**: PostgreSQL(JSON 컬럼 포함). 파일 아티팩트는 객체 스토리지.
* **관측성**: 에러/성능 모니터링, 감사 로그.

---

## 8. 버전 전략

* **버전 체계**: Semantic Versioning(SEMVER) `MAJOR.MINOR.PATCH`.
* **자동 버전 증가**: 필수 변경 시 MAJOR, 기능 추가 MINOR, 스타일/사소 변경 PATCH.
* **비교/리뷰**: Diff 뷰(노드/엣지 변화 하이라이트), 코멘트.
* **보호 규칙**: 승인자 1인 이상 필요(옵션). 롤백 시 새 버전 생성.

---

## 9. 보안·권한

* **RBAC(Role-Based Access Control)**: Owner/Editor/Viewer. 템플릿은 조직 공개/프로젝트 전용/개인 제한.
* **데이터 보호**: 전송/저장 암호화, 백업/복구 정책.
* **감사**: 사용자·시간·행위 단위 로깅.

---

## 10. 가져오기/내보내기 상세

* **JSON**: 완전 복원 가능 스냅샷.
* **SVG/PNG/PDF**: 프린트/공유용. 해상도 설정.
* **PlantUML**: 클래스 다이어그램 지원. 플로우는 단순 변환 규칙 제공.

---

## 11. 검증 규칙(Examples)

* 미연결 출력/입력 앵커 개수 경고.
* 마름모 노드는 최소 2개 이상의 출력 필요.
* 검사장비 노드는 입력/출력 방향성을 유지.
* 중복 ID, 순환 경로(옵션) 경고.

---

## 12. 성능 기준/테스트

* 대용량 문서 로딩 < 2s(캐시 기준), 상호작용 60FPS 목표.
* 단위/통합/E2E 테스트. 크로스브라우저 최신 2버전.

---

## 13. 마일스톤(예시)

* **M1 (주 2)**: 팔레트/캔버스/기본 노드, 드래그/스냅, 저장(JSON).
* **M2 (주 4)**: 엣지 스타일/라벨, 장비 노드 3종, 마름모 분기.
* **M3 (주 6)**: 속성 패널 완성, 템플릿 저장/불러오기.
* **M4 (주 8)**: 버전 관리(생성/비교/롤백), 내보내기(SVG/PNG/PDF).
* **M5 (주 10)**: 클래스 다이어그램, 검증 규칙, 접근성/i18n.
* **GA (주 12)**: 성능 튜닝, 보안 점검, 문서화.

---

## 14. 수용 기준(Acceptance Criteria)

* **AC-01**: 사용자는 노드를 끌어다 캔버스에 배치할 수 있다.
* **AC-02**: 엣지는 상/하/좌/우 앵커에 스냅되어 연결된다.
* **AC-03**: 엣지 스타일을 실선/점선/굵은선으로 전환할 수 있다.
* **AC-04**: 속성 패널에서 공정명·특이사항·산출물·운전방법을 편집하고 즉시 반영된다.
* **AC-05**: X-ray/금속검출기/중량검사기 노드를 팔레트에서 추가할 수 있다.
* **AC-06**: 마름모 노드에서 Yes/No 분기 엣지 라벨을 표시할 수 있다.
* **AC-07**: 템플릿을 저장하고 목록에서 불러와 재사용할 수 있다.
* **AC-08**: 다이어그램 생성·수정·삭제마다 버전이 생성되고 비교/롤백이 가능하다.
* **AC-09**: 클래스 다이어그램에서 클래스/속성/관계를 생성하고 저장할 수 있다.

---

## 15. 리스크 및 대응

* **R-01**: 대규모 다이어그램 성능 저하 → 가상화, 레이어링, 비가시 영역 미렌더링.
* **R-02**: 도메인 표준 아이콘/스타일 불일치 → 디자인 토큰/테마 잠금.
* **R-03**: 사용자 교육 부담 → 온보딩 튜토리얼, 템플릿 배포.

---

## 16. 오픈 이슈

* PlantUML 내보내기 범위(플로우 변환 규칙 세부화) 확정 필요.
* 조직 SSO 정책과 RBAC 통합 범위.
* 템플릿 공유 기본 스코프(조직/프로젝트/개인) 기본값.

---

## 17. 용어/약어 표

* **제품 요구사항 문서(PRD)**: Product Requirements Document.
* **사용자 인터페이스(UI)**: User Interface.
* **사용자 경험(UX)**: User Experience.
* **역할 기반 접근 제어(RBAC)**: Role-Based Access Control.
* **객체 관계 매핑(ORM)**: Object-Relational Mapping.
* **단위/종단 간(E2E)**: End-to-End.
* **의도적 중단 없이 제공(GA)**: General Availability.
* **소프트웨어 개발 키트(SDK)**: Software Development Kit.
